<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Math Challenge</title>
<style>
  /* ç§»åŠ¨ç«¯ä¼˜åŒ–çš„åŸºç¡€æ ·å¼ */
  :root {
    --main-color: #ffcc00;
    --accent-color: #4169e1;
    --correct-color: #4caf50;
    --wrong-color: #f44336;
  }

  * {
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
  }

  body {
    margin: 0;
    padding: 0;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    background: linear-gradient(#fff8dc, #f0f8ff);
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    position: relative;
    overflow-x: hidden;
    color: #333;
  }

  /* é¡¶éƒ¨ä¿¡æ¯æ  */
  .top-bar {
    position: sticky;
    top: 0;
    width: 100%;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 15px;
    background-color: rgba(255,255,255,0.9);
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    z-index: 100;
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
  }

  .back-button {
    width: 34px;
    height: 34px;
    border-radius: 50%;
    background: var(--main-color);
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    border: none;
  }

  .home-icon {
    width: 18px;
    height: 18px;
    stroke: #333;
    display: block;
  }

  /* æ¸¸æˆå®¹å™¨ */
  .game-container {
    width: 100%;
    max-width: 500px;
    padding: 15px;
    margin-top: 15px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  /* ç»Ÿè®¡ä¿¡æ¯æ  */
  .stats-bar {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    width: 100%;
    gap: 10px;
    margin-bottom: 15px;
  }

  .stat-card {
    background: white;
    border-radius: 12px;
    padding: 10px;
    text-align: center;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }

  .stat-value {
    font-size: 18px;
    font-weight: bold;
    margin-top: 5px;
  }

  /* é—®é¢˜å¡ç‰‡ */
  .question-card {
    width: 100%;
    background: white;
    border-radius: 20px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    padding: 20px;
    margin-bottom: 15px;
    animation: fadeIn 0.3s;
  }

  .question {
    font-size: 24px;
    font-weight: bold;
    text-align: center;
    margin-bottom: 20px;
  }

  /* é€‰é¡¹åŒºåŸŸ */
  .answer-input {
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 15px;
  }

  .options-container {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
    width: 100%;
  }

  .option-button {
    padding: 15px;
    font-size: 20px;
    background-color: #f5f5f5;
    border: 2px solid #ddd;
    border-radius: 10px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s;
  }

  .option-button:hover {
    background-color: #efefef;
  }

  .option-button.selected {
    background-color: var(--main-color);
    border-color: var(--accent-color);
  }

  /* æŒ‰é’®æ ·å¼ */
  .btn {
    width: 100%;
    padding: 15px;
    border: none;
    border-radius: 10px;
    font-size: 18px;
    font-weight: 600;
    cursor: pointer;
    transition: transform 0.2s, box-shadow 0.2s;
  }

  .btn:active {
    transform: scale(0.97);
  }

  .btn-primary {
    background: var(--main-color);
    color: #333;
    box-shadow: 0 4px 10px rgba(255, 204, 0, 0.3);
  }

  /* æ­¥éª¤å’Œåé¦ˆ */
  .feedback-area {
    width: 100%;
    margin-top: 10px;
    padding: 10px;
    border-radius: 10px;
    font-size: 16px;
    text-align: center;
    min-height: 20px;
  }

  .steps-container {
    width: 100%;
    margin-top: 10px;
  }

  .help-buttons {
    display: flex;
    gap: 10px;
    width: 100%;
    margin-top: 15px;
  }

  .btn-secondary {
    background: #f1f1f1;
    color: #333;
    flex: 1;
    padding: 10px;
    font-size: 16px;
  }

  /* æ­¥éª¤æ˜¾ç¤ºåŒºåŸŸ */
  .steps {
    background: #f9f9f9;
    border-radius: 10px;
    padding: 10px;
    margin-top: 10px;
    font-size: 16px;
  }

  /* åŠ¨ç”»æ•ˆæœ */
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
  }

  /* æ­£ç¡®å’Œé”™è¯¯åé¦ˆæ ·å¼ */
  .correct-feedback {
    background: rgba(76, 175, 80, 0.1);
    color: var(--correct-color);
    padding: 10px;
    border-radius: 8px;
    animation: pulse 0.5s;
  }

  .wrong-feedback {
    background: rgba(244, 67, 54, 0.1);
    color: var(--wrong-color);
    padding: 10px;
    border-radius: 8px;
  }

  /* çš®å¡ä¸˜è§’è‰² */
  .buddy {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 70px;
    height: 70px;
    filter: drop-shadow(0 5px 10px rgba(0,0,0,0.3));
    z-index: 10;
    transition: transform 0.3s;
  }

  /* è¿ç»­ç­”å¯¹æç¤º */
  .streak-message {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 32px;
    font-weight: bold;
    text-align: center;
    background: linear-gradient(45deg, var(--accent-color), #9370db);
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    z-index: 1000;
    animation: streakAnim 2s forwards;
  }

  @keyframes streakAnim {
    0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
    20% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
    80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
    100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
  }

  /* æµ®åŠ¨åŠ¨ç”» */
  @keyframes float {
    0%, 100% { transform: translateY(0) rotate(0deg); }
    50% { transform: translateY(-8px) rotate(3deg); }
  }

  .float {
    animation: float 3s ease-in-out infinite;
  }

  /* å¼€å¿ƒå’Œç”Ÿæ°”çš„åŠ¨ç”» */
  .happy {
    animation: happy 0.5s infinite alternate;
  }

  .angry {
    animation: angry 0.5s infinite alternate;
  }

  @keyframes happy {
    0% { transform: rotate(-5deg); }
    100% { transform: rotate(5deg); }
  }

  @keyframes angry {
    0% { transform: translateY(0) scale(0.95); }
    100% { transform: translateY(-5px) scale(1); }
  }

  /* é—ªå…‰ç‰¹æ•ˆ */
  .flash {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle, rgba(255,255,0,0.4) 0%, transparent 70%);
    pointer-events: none;
    z-index: 5;
    animation: flashAnim 1.5s forwards;
  }

  @keyframes flashAnim {
    0% { opacity: 0.8; }
    100% { opacity: 0; }
  }
</style>
</head>
<body>
<!-- é¡¶éƒ¨æ  -->
<div class="top-bar">
  <a href="../index.html" class="back-button">
    <svg class="home-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
      <polyline points="9 22 9 12 15 12 15 22"></polyline>
    </svg>
  </a>
  <div>Math Challenge</div>
  <div class="score-display"><span id="trophyDisplay"></span>Score: <span id="Totalscore">0</span></div>
</div>

<!-- æ¸¸æˆå®¹å™¨ -->
<div class="game-container">
  <!-- ç»Ÿè®¡ä¿¡æ¯ -->
  <div class="stats-bar">
    <div class="stat-card">
      <div>Best Record:</div>
      <div class="stat-value" id="bestScore">0</div>
    </div>
    <div class="stat-card">
      <div>Best Time:</div>
      <div class="stat-value" id="bestTime">--</div>
    </div>
    <div class="stat-card">
      <div>Last Try:</div>
      <div class="stat-value" id="lastTryTime">--</div>
    </div>
    <div class="stat-card">
      <div>Time Remain:</div>
      <div class="stat-value" id="remainingTime">3:00</div>
    </div>
  </div>

  <!-- é—®é¢˜å¡ç‰‡ -->
  <div class="question-card">
    <div class="question" id="question">Loading...</div>

    <div class="answer-input">
      <div class="options-container" id="optionsContainer">
        <!-- é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
      </div>
    </div>

    <div id="feedback" class="feedback-area"></div>

    <div class="help-buttons">
      <button class="btn btn-secondary" onclick="showNextStep()">Hint Step</button>
      <button class="btn btn-secondary" onclick="showAnswer()">Show Answer</button>
    </div>

    <div id="steps" class="steps"></div>
  </div>
</div>

<!-- çš®å¡ä¸˜ä¼™ä¼´ -->
<div class="buddy float" id="buddy">
  <svg viewBox="0 0 200 250">
    <defs>
      <linearGradient id="pikachuGradient" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style="stop-color:#4169e1"/>
        <stop offset="100%" style="stop-color:#9370db"/>
      </linearGradient>
    </defs>
    <!-- å°¾å·´ -->
    <polygon points="150,140 180,120 160,100 190,80 170,60 140,90" fill="url(#pikachuGradient)" stroke="black" stroke-width="2"/>
    <ellipse cx="100" cy="160" rx="50" ry="60" fill="url(#pikachuGradient)" stroke="black" stroke-width="2"/>
    <circle cx="100" cy="80" r="40" fill="url(#pikachuGradient)" stroke="black" stroke-width="2"/>
    <!-- è€³æœµ -->
    <polygon points="65,20 80,60 50,50" fill="url(#pikachuGradient)" stroke="black" stroke-width="2"/>
    <polygon points="65,20 60,40 70,30" fill="black"/>
    <polygon points="135,20 120,60 150,50" fill="url(#pikachuGradient)" stroke="black" stroke-width="2"/>
    <polygon points="135,20 140,40 130,30" fill="black"/>
    <!-- çœ¼ç› -->
    <g><circle id="eyeL" cx="85" cy="70" r="5" fill="black"><animate attributeName="r" values="5;1;5" dur="3s" repeatCount="indefinite"/></circle></g>
    <g><circle id="eyeR" cx="115" cy="70" r="5" fill="black"><animate attributeName="r" values="5;1;5" dur="3s" repeatCount="indefinite"/></circle></g>
    <circle cx="70" cy="90" r="6" fill="red"/>
    <circle cx="130" cy="90" r="6" fill="red"/>
    <path id="mouth" d="M 85 100 Q 100 115 115 100" stroke="black" stroke-width="2" fill="none"/>
    <!-- æ‰‹è„š -->
    <line id="leftHand" x1="70" y1="140" x2="50" y2="120" stroke="black" stroke-width="5" />
    <line id="rightHand" x1="130" y1="140" x2="150" y2="120" stroke="black" stroke-width="5" />
    <line x1="80" y1="210" x2="80" y2="230" stroke="black" stroke-width="5" />
    <line x1="120" y1="210" x2="120" y2="230" stroke="black" stroke-width="5" />
     </svg>
</div>

<script>
// å…¨å±€å˜é‡
let num1, num2, steps, currentStep;
let answered = false;
let correct = 0;
let Totalscore = 0;
let bestScore = localStorage.getItem('bestScore') || 0;
let killStreak = 0;
let startTime = 0;
let bestTime = localStorage.getItem('bestTime') ? parseFloat(localStorage.getItem('bestTime')) : null;
let lastTryTime = null;
let selectedOption = null;
let correctAnswerIndex = null;

// è®¡æ—¶å™¨ç›¸å…³å˜é‡
let gameTimeInSeconds = 90; // 5åˆ†é’Ÿ = 300ç§’
let remainingTimeInSeconds = gameTimeInSeconds;
let timerInterval = null;
let gameActive = false;

// æ˜¾ç¤ºåˆå§‹åŒ–çš„å€¼
document.getElementById('bestScore').innerText = bestScore;
document.getElementById('bestTime').innerText = bestTime ? bestTime.toFixed(2) + 's' : '--';
document.getElementById('lastTryTime').innerText = '--';
document.getElementById('remainingTime').innerText = formatTime(remainingTimeInSeconds);

// éšæœºæ•°ç”Ÿæˆç®—æ³• - é¿å…é‡å¤å‡ºé¢˜
let arrNum = [], arrRnd = [], arr_x = 0;
let initialRun = true;

function RandomNumber(x1, x2) {
  let NumLength = x2 - x1;
  let arr_i;

  if (initialRun) {
    if (arrNum.length == 0) {
      for (arr_i = 0; arr_i <= NumLength; arr_i++) {
        arrNum.push({value: (x1 + arr_i), flag: false});
      }
    } else {
      for (arr_i = 0; arr_i <= NumLength; arr_i++) {
        arrNum[arr_i].flag = false;
      }
    }

    let arr_add = 0;
    while (arr_add <= NumLength) {
      let rnd_i = Math.floor(Math.random() * (NumLength + 1));
      if (arrNum[rnd_i].flag == false) {
        arrRnd[arr_add++] = arrNum[rnd_i].value;
        arrNum[rnd_i].flag = true;
      }
    }
    initialRun = false;
  }

  if (arr_x == NumLength) {
    initialRun = true;
    arr_x = 0;
    return arrRnd[NumLength];
  } else {
    return arrRnd[arr_x++];
  }
}
// ç”Ÿæˆé¢˜ç›®
function generateQuestion() {
  num1 = RandomNumber(1, 15);
  num2 = 3;
  document.getElementById('question').innerText = `${num1} Ã— ${num2} = ?`;
  steps = generateSteps(num1, num2);
  currentStep = 0;
  document.getElementById('steps').innerHTML = '';
  document.getElementById('feedback').innerHTML = '';
  // æäº¤æŒ‰é’®å·²ç§»é™¤
  answered = false;
  resetPikachu();
  
  // ç”Ÿæˆé€‰é¡¹
  generateOptions();
  
  // è®°å½•å¼€å§‹æ—¶é—´
  startTime = performance.now();
}

// ç”Ÿæˆé€‰é¡¹
function generateOptions() {
  const correctAnswer = num1 * num2;
  const optionsContainer = document.getElementById('optionsContainer');
  optionsContainer.innerHTML = '';
  
  // ç”Ÿæˆ3ä¸ªå¹²æ‰°é¡¹
  let options = [correctAnswer];
  let AnswerAdd = -1;
  while (options.length < 4) {
    // ç”Ÿæˆæ¥è¿‘æ­£ç¡®ç­”æ¡ˆçš„å¹²æ‰°é¡¹
    //console.log('å½“å‰æ­£ç¡®ç­”æ¡ˆ:', correctAnswer);
    let wrongAnswer = correctAnswer + 10 * Math.floor(Math.random() * 4 - 2);
    //console.log('å½“å‰æ­£ç¡®ç­”æ¡ˆ:', correctAnswer,'wrongAnswer:', wrongAnswer);
    if (wrongAnswer == correctAnswer || wrongAnswer <= 0) {
      wrongAnswer = correctAnswer + num2 *Math.floor(Math.random() * 4+1); // ç¡®ä¿å¹²æ‰°é¡¹ä¸ºæ­£æ•°
    }
    // ç¡®ä¿ä¸é‡å¤ä¸”ä¸ç­‰äºæ­£ç¡®ç­”æ¡ˆ
    if (wrongAnswer !== correctAnswer && !options.includes(wrongAnswer) && wrongAnswer > 0) {
      options.push(wrongAnswer);
    }
  }
  
  // éšæœºæ‰“ä¹±é€‰é¡¹é¡ºåº
  options = options.sort(() => Math.random() - 0.5);
  
  // è®°å½•æ­£ç¡®ç­”æ¡ˆçš„ç´¢å¼•
  correctAnswerIndex = options.indexOf(correctAnswer);
  
  // åˆ›å»ºé€‰é¡¹æŒ‰é’®
  options.forEach((option, index) => {
    const button = document.createElement('div');
    button.className = 'option-button';
    button.textContent = option;
    button.dataset.index = index;
    
    button.addEventListener('click', function() {
      if (answered) {
        // å¦‚æœå·²ç»å›ç­”è¿‡ï¼Œç‚¹å‡»ä»»ä½•é€‰é¡¹éƒ½è¿›å…¥ä¸‹ä¸€é¢˜
        if (gameActive) generateQuestion();
        return;
      }

      // æ¸…é™¤æ‰€æœ‰é€‰ä¸­çŠ¶æ€
      document.querySelectorAll('.option-button').forEach(btn => {
        btn.classList.remove('selected');
      });
      
      // è®¾ç½®å½“å‰é€‰ä¸­çŠ¶æ€
      this.classList.add('selected');
      selectedOption = parseInt(this.dataset.index);
      
      // ç›´æ¥æäº¤ç­”æ¡ˆ
      submitAnswer();
    });
    
    optionsContainer.appendChild(button);
  });
  
  // é‡ç½®é€‰ä¸­çŠ¶æ€å’Œç­”æ¡ˆçŠ¶æ€
  selectedOption = null;
  
  // æ·»åŠ æç¤ºä¿¡æ¯ï¼Œå‘ŠçŸ¥ç”¨æˆ·ç‚¹å‡»é€‰é¡¹å³å¯ä½œç­”
  document.getElementById('feedback').innerHTML = '<div class="info-feedback">Select an Answer to Start!</div>';
}

// ç”Ÿæˆè§£é¢˜æ­¥éª¤
function generateSteps(a, b) {
  let sumPart = `${a} x ${b} = ${a * b}`;
  return [sumPart];
}

// æ˜¾ç¤ºä¸‹ä¸€ä¸ªæç¤ºæ­¥éª¤
function showNextStep() {
  if (currentStep < steps.length) {
    document.getElementById('steps').innerHTML += `<div>â¡ï¸ ${steps[currentStep]}</div>`;
    currentStep++;
  } else {
    document.getElementById('steps').innerHTML += `<div>âœ… Done!</div>`;
  }
}

// æäº¤ç­”æ¡ˆ
function submitAnswer() {
  const correctAnswer = num1 * num2;

  if (!answered) {
    if (selectedOption === null) {
      document.getElementById('feedback').innerHTML = `<div class="wrong-feedback">Select an Answer!</div>`;
    } else if (selectedOption === correctAnswerIndex) {
      // è®¡ç®—å›ç­”æ—¶é—´
      const endTime = performance.now();
      const timeSpent = (endTime - startTime) / 1000; // è½¬æ¢ä¸ºç§’

      // æ›´æ–°æœ€åä¸€æ¬¡å°è¯•æ—¶é—´
      lastTryTime = timeSpent;
      document.getElementById('lastTryTime').innerText = lastTryTime.toFixed(2) + 's';

      // æ›´æ–°æœ€ä½³æ—¶é—´
      if (bestTime === null || timeSpent < bestTime) {
        bestTime = timeSpent;
        localStorage.setItem('bestTime', bestTime);
        document.getElementById('bestTime').innerText = bestTime.toFixed(2) + 's';
      }

      document.getElementById('feedback').innerHTML = `<div style="color: green;">ğŸ‰ Correct! Great job! </div>`;
      celebrate();
      correct++;
      killStreak++;
      Totalscore+=killStreak/2;
      document.getElementById('Totalscore').innerText = Totalscore*10; // æ¯ç­”å¯¹ä¸€ä¸ªé¢˜ç›®åŠ 10åˆ†ï¼Œæ¯è¿å‡»åŠ 5åˆ†
      // æ¯5åˆ†æ˜¾ç¤ºä¸€ä¸ªå¥–æ¯
      const trophyCount = Math.floor(correct / 5);
      document.getElementById('trophyDisplay').innerText = trophyCount > 0 ? 'ğŸ…'.repeat(trophyCount) + ' ' : '';
      // ä¸å†æ›´æ–°killStreakæ˜¾ç¤º

      if (killStreak >= 2) {
        showKillStreak(killStreak);
      }

      if (correct > bestScore) {
        bestScore = correct;
        localStorage.setItem('bestScore', bestScore);
        document.getElementById('bestScore').innerText = bestScore;
      }
    } else {
      document.getElementById('feedback').innerHTML = `<div style="color: red;">âŒ Oops! Try again!</div>`;
      showAnswer();
      angry();
      // ä¸å†æ›´æ–°killStreakæ˜¾ç¤º
    }
    // è®¾ç½®å·²å›ç­”çŠ¶æ€ï¼Œç‚¹å‡»ä»»ä½•é€‰é¡¹éƒ½å°†è¿›å…¥ä¸‹ä¸€é¢˜
    answered = true;
  } else {
    if (gameActive) generateQuestion();
  }
}

// æ˜¾ç¤ºç­”æ¡ˆ
function showAnswer() {
  document.getElementById('steps').innerHTML += `<div>ğŸ¯ Final Answer: ${num1 * num2}</div>`;
  answered = true;
  killStreak = 0;
}

// åº†ç¥åŠ¨ç”»
function celebrate() {
  document.getElementById('buddy').classList.add('happy');
  document.getElementById('buddy').classList.remove('float', 'angry');
  //document.getElementById('correctSound').play();

  let flash = document.createElement('div');
  flash.className = 'flash';
  document.body.appendChild(flash);
  setTimeout(() => {
    if (document.body.contains(flash)) {
      document.body.removeChild(flash);
    }
  }, 1500);

  setTimeout(() => {
    document.getElementById('buddy').classList.remove('happy');
    document.getElementById('buddy').classList.add('float');
  }, 2000);
}

// ä¸å¼€å¿ƒåŠ¨ç”»
function angry() {
  document.getElementById('buddy').classList.add('angry');
  document.getElementById('buddy').classList.remove('float', 'happy');
  document.getElementById('mouth').setAttribute('d', "M 85 100 Q 100 85 115 100");

  setTimeout(() => {
    document.getElementById('buddy').classList.remove('angry');
    document.getElementById('buddy').classList.add('float');
  }, 2000);
}

// é‡ç½®çš®å¡ä¸˜çŠ¶æ€
function resetPikachu() {
  document.getElementById('buddy').className = 'buddy float';
  document.getElementById('mouth').setAttribute('d', "M 85 100 Q 100 115 115 100");
}

// æ˜¾ç¤ºè¿ç»­ç­”å¯¹æç¤º
function showKillStreak(streak) {
  let streakMessages = {
    2: 'Double Kill!',
    3: 'Triple Kill!',
    4: 'Quadra Kill!',
    5: 'Penta Kill!',
    10: 'Unstoppable!',
    15: 'Dominating!',
    20: 'Godlike!',
    30: 'Legendary!'
  };

  // åªåœ¨ç‰¹å®šçš„è¿å‡»æ•°æ˜¾ç¤ºæ¶ˆæ¯
  let message = '';
  if (streak in streakMessages) {
    message = streakMessages[streak];
  } else if (streak > 20 && streak % 5 === 0) {
    message = `${streak} Correct Answers! Keep it up!`;
  } else {
    return; // ä¸æ˜¾ç¤ºæ¶ˆæ¯
  }

  let streakElement = document.createElement('div');
  streakElement.className = 'streak-message';
  streakElement.innerText = message;
  document.body.appendChild(streakElement);

  // æ’­æ”¾è¿å‡»éŸ³æ•ˆ
  //document.getElementById('streakSound').play();

  setTimeout(() => {
    if (document.body.contains(streakElement)) {
      document.body.removeChild(streakElement);
    }
  }, 2000);
}

// é¡µé¢è½½å…¥
// æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤ºï¼šåˆ†:ç§’
function formatTime(seconds) {
  const minutes = Math.floor(seconds / 60);
  const remainingSeconds = seconds % 60;
  return `${minutes}:${remainingSeconds < 10 ? '0' : ''}${remainingSeconds}`;
}

// å¯åŠ¨æ¸¸æˆè®¡æ—¶å™¨
function startGameTimer() {
  if (timerInterval) clearInterval(timerInterval);
  gameActive = true;
  remainingTimeInSeconds = gameTimeInSeconds;
  document.getElementById('remainingTime').innerText = formatTime(remainingTimeInSeconds);
  
  timerInterval = setInterval(() => {
    remainingTimeInSeconds--;
    document.getElementById('remainingTime').innerText = formatTime(remainingTimeInSeconds);
    
    if (remainingTimeInSeconds <= 0) {
      clearInterval(timerInterval);
      gameActive = false;
      showGameOverScreen();
    }
  }, 1000);
}

// æ¸¸æˆç»“æŸæ—¶æ˜¾ç¤º
function showGameOverScreen() {
  // åˆ›å»ºè¦†ç›–å±‚
  const overlay = document.createElement('div');
  overlay.style.position = 'fixed';
  overlay.style.top = '0';
  overlay.style.left = '0';
  overlay.style.width = '100%';
  overlay.style.height = '100%';
  overlay.style.backgroundColor = 'rgba(0, 0, 0, 0.8)';
  overlay.style.display = 'flex';
  overlay.style.flexDirection = 'column';
  overlay.style.justifyContent = 'center';
  overlay.style.alignItems = 'center';
  overlay.style.zIndex = '1000';
  
  // æ”¾å¤§çš®å¡ä¸˜
  const pikachuClone = document.querySelector('#buddy').cloneNode(true);
  pikachuClone.style.position = 'relative';
  pikachuClone.style.width = '200px';
  pikachuClone.style.height = '200px';
  pikachuClone.style.bottom = 'auto';
  pikachuClone.style.right = 'auto';
  pikachuClone.style.margin = '20px';
  
  // åˆ›å»ºç»“æŸæ¶ˆæ¯
  const message = document.createElement('div');
  message.style.color = 'white';
  message.style.fontSize = '32px';
  message.style.fontWeight = 'bold';
  message.style.marginBottom = '30px';
  message.textContent = 'Time Over!';
  
    // æ˜¾ç¤ºç»“æŸ
  const endMsg = document.createElement('div');
  endMsg.style.color = '#ffcc00';
  endMsg.style.fontSize = '24px';
  endMsg.style.marginBottom = '30px';
  endMsg.textContent = `Congratulations!`;

  // æ˜¾ç¤ºæ€»åˆ†
  const scoreMsg = document.createElement('div');
  scoreMsg.style.color = '#ffcc00';
  scoreMsg.style.fontSize = '24px';
  scoreMsg.style.marginBottom = '30px';
  scoreMsg.textContent = `You got ${correct} correct and ${Math.floor(Totalscore*10)} points!`;
  
  // åˆ›å»ºæŒ‰é’®å®¹å™¨
  const buttonContainer = document.createElement('div');
  buttonContainer.style.display = 'flex';
  buttonContainer.style.gap = '20px';
  
  // åˆ›å»ºç•™åœ¨æœ¬é¡µæŒ‰é’®
  const stayButton = document.createElement('button');
  stayButton.className = 'btn btn-primary';
  stayButton.style.padding = '15px 30px';
  stayButton.textContent = 'Try Again';
  stayButton.onclick = function() {
    document.body.removeChild(overlay);
    resetGame();
  };
  
  // åˆ›å»ºä¸‹ä¸€å…³æŒ‰é’®
  const nextButton = document.createElement('button');
  nextButton.className = 'btn btn-primary';
  nextButton.style.padding = '15px 30px';
  nextButton.style.backgroundColor = '#4169e1';
  nextButton.textContent = 'Next Level';
  nextButton.onclick = function() {
    window.location.href = 'Math Basic 03.html';
  };
  
  // æ·»åŠ åˆ°é¡µé¢
  buttonContainer.appendChild(stayButton);
  buttonContainer.appendChild(nextButton);
  overlay.appendChild(message);
  overlay.appendChild(pikachuClone);
  overlay.appendChild(endMsg);
  overlay.appendChild(scoreMsg);
  overlay.appendChild(buttonContainer);
  document.body.appendChild(overlay);
}

// é‡ç½®æ¸¸æˆ
function resetGame() {
  Totalscore = 0;
  correct = 0;
  killStreak = 0;
  document.getElementById('Totalscore').innerText = '0';
  document.getElementById('trophyDisplay').innerText = '';
  startGameTimer();
  generateQuestion();
}

// é¡µé¢è½½å…¥
window.onload = () => {
  document.getElementById('buddy').classList.add('float');
  setTimeout(() => {
    startGameTimer();
    generateQuestion();
  }, 500);

  // æ·»åŠ è§¦æ‘¸åé¦ˆ
  const buttons = document.querySelectorAll('.btn');
  buttons.forEach(button => {
    button.addEventListener('touchstart', function() {
      this.style.transform = 'scale(0.97)';
    });
    button.addEventListener('touchend', function() {
      this.style.transform = 'scale(1)';
    });
  });
};
</script>
</body>
</html>